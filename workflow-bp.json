{
  "workflowContent": "{   \"name\": \"Outlook Email Classifier\",   \"nodes\": [     {       \"parameters\": {         \"operation\": \"getAll\",         \"limit\": 50,         \"filtersUI\": {           \"values\": {             \"filters\": {               \"foldersToInclude\": [                 \"AAMkADM2MzM1NzJjLTAyZTUtNDE3MC04OWU3LTUxYzk0NGNiOTM0OQAuAAAAAACBU7NZ96JvT7ihrRw8zJg5AQACvvP6pH_zTpT4959R3D0FAAAAAAEMAAA=\"               ]             }           }         },         \"options\": {}       },       \"type\": \"n8n-nodes-base.microsoftOutlook\",       \"typeVersion\": 2,       \"position\": [         448,         0       ],       \"id\": \"218a7293-b929-4348-8b33-138839e499bf\",       \"name\": \"Get many messages\",       \"webhookId\": \"b57eb7b0-061b-47db-aff9-37503ab09f21\",       \"credentials\": {         \"microsoftOutlookOAuth2Api\": {           \"id\": \"0TvrPrmnpLWzV57j\",           \"name\": \"Microsoft Outlook account 6\"         }       }     },     {       \"parameters\": {         \"jsCode\": \"// Email Classification System for N8N\\n// This code classifies emails into importance levels: high, medium, low\\n\\nconst classifiedEmails = [];\\n\\n// Define your VIP senders here \\nconst vipSenders = [\\n  'bpearcy@streetdiligence.com',\\n  'hazelton@streetdiligence.com',\\n  'yelsirgany@streetdiligence.com',\\n  // Add more VIP emails here\\n];\\n\\n// Define important domains \\nconst importantDomains = [\\n  'streetdiligence.com',\\n  // Add important client domains here\\n];\\n\\n// Define urgent keywords\\nconst urgentKeywords = [\\n  'urgent',\\n  'meeting',\\n  'asap',\\n  'critical',\\n  'emergency',\\n  'immediate',\\n  'important',\\n  'deadline',\\n  'overdue'\\n];\\n\\n// Define automated email patterns\\nconst automatedPatterns = [\\n  'noreply@',\\n  'no-reply@',\\n  'notifications@',\\n  'automated@',\\n  'system@',\\n  'mailer-daemon@',\\n  'postmaster@'\\n];\\n\\n// Define low-priority domains\\nconst lowPriorityDomains = [\\n  'atlassian.net',\\n  'github.com',\\n  'linkedin.com',\\n  'twitter.com',\\n  'facebook.com',\\n  'mailchimp.com',\\n  'constantcontact.com',\\n  'hubspot.com'\\n];\\n\\n// Process each email\\nfor (const item of $input.all()) {\\n  const email = item.json;\\n  \\n  // Initialize classification\\n  let importance = 'medium'; // default\\n  let category = 'general';\\n  let reasons = []; // Track why email was classified this way\\n  \\n  // Extract email details safely\\n  // Handle both string and object formats\\n  const from = (typeof email.from === 'string' \\n    ? email.from \\n    : email.from?.emailAddress?.address || email.from\\n  )?.toLowerCase() || '';\\n  const fromName = email.from?.emailAddress?.name || '';\\n  const subject = email.subject || '';\\n  const subjectLower = subject.toLowerCase();\\n  const toRecipients = email.toRecipients || [];\\n  const ccRecipients = email.ccRecipients || [];\\n  const bccRecipients = email.bccRecipients || [];\\n  const bodyPreview = email.bodyPreview || '';\\n  const bodyLower = bodyPreview.toLowerCase();\\n  const hasAttachments = email.hasAttachments || false;\\n  \\n  // Calculate recipient counts\\n  const totalRecipients = toRecipients.length + ccRecipients.length;\\n  const isOnlyRecipient = toRecipients.length === 1 && ccRecipients.length === 0;\\n  \\n  // Extract sender domain\\n  const senderDomain = from.split('@')[1] || '';\\n  \\n  // ====================\\n  // CHECK VIP SENDERS FIRST - ALWAYS HIGH PRIORITY\\nconst isVipSender = vipSenders.some(vip => {\\n  const vipLower = vip.toLowerCase();\\n  return from === vipLower || from.includes(vipLower);\\n});\\n\\nif (isVipSender) {\\n  importance = 'high';\\n  category = 'vip_sender';\\n  reasons.push(`VIP sender: ${from}`);\\n  console.log(`VIP EMAIL FOUND: ${from} - ${subject}`);\\n}\\n  // ====================\\n  // THEN CHECK FOR LOW IMPORTANCE\\n  // ====================\\n  \\n  // 1. Jira/Atlassian emails\\n  else if (from.includes('atlassian.net') || \\n      from.includes('jira@') ||\\n      subject.includes('[JIRA]') ||\\n      subject.includes('[Confluence]') ||\\n      (subject.includes('You have') && subject.includes('overdue item')) ||\\n      subject.includes('mentioned you') ||\\n      subject.includes('assigned to you')) {\\n    importance = 'low';\\n    category = 'jira_notification';\\n    reasons.push('Jira/Atlassian notification');\\n  }\\n  \\n  // 2. GitHub notifications\\n  else if (from.includes('github.com') || \\n           subject.includes('[GitHub]') ||\\n           from.includes('noreply@github.com')) {\\n    importance = 'low';\\n    category = 'github_notification';\\n    reasons.push('GitHub notification');\\n  }\\n  \\n  // 3. Other automated emails\\n  else if (automatedPatterns.some(pattern => from.includes(pattern))) {\\n    importance = 'low';\\n    category = 'automated';\\n    reasons.push('Automated email pattern');\\n  }\\n  \\n  // 4. Marketing/Newsletter emails\\n  else if (from.includes('newsletter') || \\n           from.includes('marketing') ||\\n           subject.includes('newsletter') ||\\n           subject.includes('unsubscribe') ||\\n           bodyPreview.includes('unsubscribe')) {\\n    importance = 'low';\\n    category = 'marketing';\\n    reasons.push('Marketing/Newsletter');\\n  }\\n  \\n  // 5. Low-priority domains\\n  else if (lowPriorityDomains.some(domain => senderDomain === domain)) {\\n    importance = 'low';\\n    category = 'low_priority_domain';\\n    reasons.push(`From low-priority domain: ${senderDomain}`);\\n  }\\n  \\n  // 6. Mass emails (many recipients)\\n  else if (totalRecipients > 10) {\\n    importance = 'low';\\n    category = 'mass_email';\\n    reasons.push(`Mass email with ${totalRecipients} recipients`);\\n  }\\n  \\n  // ====================\\n  // OTHER HIGH IMPORTANCE CHECKS\\n  // ====================\\n  \\n  // 1. Important domains (your company domain) - direct emails only\\n  else if (importantDomains.some(domain => senderDomain === domain) && isOnlyRecipient) {\\n    importance = 'high';\\n    category = 'internal_direct';\\n    reasons.push('Internal email sent directly to you');\\n  }\\n  \\n  // 2. Urgent keywords in subject\\n  else if (urgentKeywords.some(keyword => subjectLower.includes(keyword))) {\\n    importance = 'high';\\n    category = 'urgent';\\n    const foundKeywords = urgentKeywords.filter(keyword => subjectLower.includes(keyword));\\n    reasons.push(`Urgent keywords: ${foundKeywords.join(', ')}`);\\n  }\\n  \\n  // 3. You're the only recipient (external sender)\\n  else if (isOnlyRecipient && !lowPriorityDomains.includes(senderDomain)) {\\n    importance = 'high';\\n    category = 'direct_external';\\n    reasons.push('External email sent only to you');\\n  }\\n  \\n  // 4. Has attachments and is direct email\\n  else if (hasAttachments && totalRecipients <= 3) {\\n    importance = 'high';\\n    category = 'attachment_direct';\\n    reasons.push('Has attachments and few recipients');\\n  }\\n \\n  // ====================\\n  // MEDIUM IMPORTANCE (Default for anything not caught above)\\n  // ====================\\n  else {\\n    // Already set to medium by default\\n    if (importantDomains.some(domain => senderDomain === domain)) {\\n      category = 'internal_general';\\n      reasons.push('Internal company email');\\n    } else {\\n      category = 'external_general';\\n      reasons.push('General external email');\\n    }\\n  }\\n  \\n  // Create the classified email object\\n  const classifiedEmail = {\\n    // Original email data\\n    ...email,\\n    // Classification data\\n    classification: {\\n      importance: importance,\\n      category: category,\\n      reasons: reasons,\\n      processed: true,\\n      processedAt: new Date().toISOString()\\n    },\\n    // Useful extracted data\\n    metadata: {\\n      senderDomain: senderDomain,\\n      isOnlyRecipient: isOnlyRecipient,\\n      totalRecipients: totalRecipients,\\n      hasAttachments: hasAttachments,\\n      subjectLength: subject.length\\n    }\\n  };\\n  \\n  classifiedEmails.push(classifiedEmail);\\n}\\n\\n// Return summary and classified emails\\nreturn [\\n  {\\n    json: {\\n      summary: {\\n        total: classifiedEmails.length,\\n        high: classifiedEmails.filter(e => e.classification.importance === 'high').length,\\n        medium: classifiedEmails.filter(e => e.classification.importance === 'medium').length,\\n        low: classifiedEmails.filter(e => e.classification.importance === 'low').length,\\n        categories: classifiedEmails.reduce((acc, email) => {\\n          acc[email.classification.category] = (acc[email.classification.category] || 0) + 1;\\n          return acc;\\n        }, {})\\n      },\\n      emails: classifiedEmails\\n    }\\n  }\\n];\"       },       \"type\": \"n8n-nodes-base.code\",       \"typeVersion\": 2,       \"position\": [         512,         224       ],       \"id\": \"b0f130ee-f31b-4ee8-bfbf-e1caa2b2121f\",       \"name\": \"Code\"     },     {       \"parameters\": {         \"options\": {           \"reset\": \"=\"         }       },       \"type\": \"n8n-nodes-base.splitInBatches\",       \"typeVersion\": 3,       \"position\": [         704,         224       ],       \"id\": \"e90f7a11-b5ea-4282-ac49-290320a6ec65\",       \"name\": \"Loop Over Items\"     },     {       \"parameters\": {         \"conditions\": {           \"options\": {             \"caseSensitive\": true,             \"leftValue\": \"\",             \"typeValidation\": \"strict\",             \"version\": 2           },           \"conditions\": [             {               \"id\": \"5e18a2fe-59c7-43e3-80bf-8ede9bd22836\",               \"leftValue\": \"=\",               \"rightValue\": \"low\",               \"operator\": {                 \"type\": \"string\",                 \"operation\": \"equals\",                 \"name\": \"filter.operator.equals\"               }             }           ],           \"combinator\": \"and\"         },         \"options\": {}       },       \"type\": \"n8n-nodes-base.if\",       \"typeVersion\": 2.2,       \"position\": [         912,         208       ],       \"id\": \"5a75603a-ba9a-45af-b66d-4df7f1725db8\",       \"name\": \"If\"     },     {       \"parameters\": {         \"httpMethod\": \"POST\",         \"path\": \"95f59c11-cc87-45b1-b316-085d03aef838\",         \"responseMode\": \"responseNode\",         \"options\": {           \"allowedOrigins\": \"*\"         }       },       \"type\": \"n8n-nodes-base.webhook\",       \"typeVersion\": 2,       \"position\": [         224,         0       ],       \"id\": \"18e5b19e-5cc6-4964-9bc0-8e7604c15734\",       \"name\": \"Webhook\",       \"webhookId\": \"95f59c11-cc87-45b1-b316-085d03aef838\"     },     {       \"parameters\": {         \"operation\": \"update\",         \"messageId\": {           \"__rl\": true,           \"value\": \"\",           \"mode\": \"id\"         },         \"updateFields\": {           \"isRead\": true         }       },       \"type\": \"n8n-nodes-base.microsoftOutlook\",       \"typeVersion\": 2,       \"position\": [         1104,         192       ],       \"id\": \"731edf7f-7507-4069-b944-626aeabe3b0b\",       \"name\": \"Update a message\",       \"webhookId\": \"bfbd174a-4613-48e1-8f36-dd9c662f500e\",       \"credentials\": {         \"microsoftOutlookOAuth2Api\": {           \"id\": \"0TvrPrmnpLWzV57j\",           \"name\": \"Microsoft Outlook account 6\"         }       }     },     {       \"parameters\": {         \"respondWith\": \"allIncomingItems\",         \"options\": {           \"responseCode\": 200,           \"responseHeaders\": {             \"entries\": [               {                 \"name\": \"Content-Type\",                 \"value\": \"application/json\"               }             ]           }         }       },       \"type\": \"n8n-nodes-base.respondToWebhook\",       \"typeVersion\": 1.4,       \"position\": [         912,         64       ],       \"id\": \"4266afa2-62c6-46a9-80cd-d24d67da13f0\",       \"name\": \"Respond to Webhook\"     },     {       \"parameters\": {         \"assignments\": {           \"assignments\": [             {               \"id\": \"66705703-de6c-4cf4-886a-1acf167f4c67\",               \"name\": \"success\",               \"value\": \"true\",               \"type\": \"string\"             },             {               \"id\": \"0637450f-1e6e-4fc2-a64b-50bdcdc53559\",               \"name\": \"summary\",               \"value\": \"=\",               \"type\": \"object\"             },             {               \"id\": \"5746b3f5-9fbd-4de5-9705-e5708a123c9a\",               \"name\": \"emails\",               \"value\": \"=\",               \"type\": \"array\"             }           ]         },         \"options\": {}       },       \"type\": \"n8n-nodes-base.set\",       \"typeVersion\": 3.4,       \"position\": [         704,         64       ],       \"id\": \"cf0c2d3f-012d-477b-baf3-f2f6bc486813\",       \"name\": \"Edit Fields\"     }   ],   \"pinData\": {},   \"connections\": {     \"Get many messages\": {       \"main\": [         [           {             \"node\": \"Code\",             \"type\": \"main\",             \"index\": 0           }         ]       ]     },     \"Code\": {       \"main\": [         [           {             \"node\": \"Loop Over Items\",             \"type\": \"main\",             \"index\": 0           },           {             \"node\": \"Edit Fields\",             \"type\": \"main\",             \"index\": 0           }         ]       ]     },     \"Loop Over Items\": {       \"main\": [         [           {             \"node\": \"If\",             \"type\": \"main\",             \"index\": 0           }         ],         [           {             \"node\": \"Loop Over Items\",             \"type\": \"main\",             \"index\": 0           }         ]       ]     },     \"Webhook\": {       \"main\": [         [           {             \"node\": \"Get many messages\",             \"type\": \"main\",             \"index\": 0           }         ]       ]     },     \"If\": {       \"main\": [         [           {             \"node\": \"Update a message\",             \"type\": \"main\",             \"index\": 0           }         ]       ]     },     \"Edit Fields\": {       \"main\": [         [           {             \"node\": \"Respond to Webhook\",             \"type\": \"main\",             \"index\": 0           }         ]       ]     }   },   \"active\": true,   \"settings\": {     \"executionOrder\": \"v1\"   },   \"versionId\": \"201b93ee-e702-4e9d-bbcc-2c0e4cfb4a5f\",   \"meta\": {     \"templateCredsSetupCompleted\": true,     \"instanceId\": \"3c314775e903e0b412dacefcc6c7568a3f8f3dbdff34227bf403756870e4cdda\"   },   \"id\": \"CmyEFLccbUPTILVf\",   \"tags\": [] }"
}
